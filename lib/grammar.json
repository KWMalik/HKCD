{   
    "lex": {
        "macros": {
            "Letter": "[a-zA-Z]",
            "Digit" : "[0-9]",
            "NonZeroDigit" : "[1-9]",
        },
        
        "rules": [
            ["/\\*(.|\\n|\\r|\\r\\n)*?\\*/",    "/* skip */"],
            ["//.*",                            "/* skip */"],
            ["\\s+",                            "/* skip */"],
            ["(class|public|static|void|main|String|extends|int|boolean|return|if|else|while|true|new|null|false|this)\\b", "return yytext;"],
            ["System\\.out\\.println\\b",       "return 'printLine';"],
            ["{Letter}({Letter}|{Digit})*",     "return 'ID';"],
            ["({NonZeroDigit}{Digit}*|0)",      "return 'Integer';"],
            ["(\\!=|\\!|-|\\+|\\*|&&|\\/|>=|>|<=|<|==|\\|\\||\\{|\\}|\\[|\\]|\\(|\\)|\\.|;|,|=)", "return yytext;"],
        ]
    },
    
    "operators": [
        ["right", "="],
        ["left", "||"],
        ["left", "&&"],
        ["nonassoc", "==", "!="],
        ["left", "<", "<=", ">", ">="],
        ["left", "+", "-"],
        ["left", "*", "/"],
        ["right", "!", "UMINUS", "."],
    ],

    "bnf": { 
        "Program":          [
                                ["MainClassDecl ClassDeclList", "$$ = new yy.ASTNode('Program', [$1].concat($2)); return $$;"],
                            ],
        "MainClassDecl":    [
                                ["class JavaID { public static void main ( String [ ] JavaID ) { StmtList } }", "$$ = new yy.ASTNode('MainClassDecl', [].concat($15), { 'className': $2, 'param': $12, 'superClassName': null, 'lineNumber': yylineno });"],
                            ],
        "ClassDeclList":    [
                                ["", "$$ = [];"],
                                ["ClassDecl ClassDeclList", "$2.unshift($1); $$ = $2;"],
                            ],
        "ClassDecl":        [
                                ["class JavaID Extension { ClassVarDeclList MethodDeclList }", "$$ = new yy.ASTNode('ClassDecl', [].concat($5, $6), { 'className': $2, 'superClassName': $3, 'lineNumber': yylineno });"],
                            ],
        "Extension":        [
                                ["", "$$ = null;"],
                                ["extends JavaID", "$$ = $2;"],
                            ],
        "ClassVarDeclList": [
                                ["", "$$ = [];"],
                                ["ClassVarDecl ClassVarDeclList", "$2.unshift($1); $$ = $2;"],
                            ],
        "ClassVarDecl":     [
                                ["Type JavaID ;", "$$ = new yy.ASTNode('ClassVarDecl', [], { 'type': $1, 'fieldName': $2, 'lineNumber': yylineno });"],
                            ],
        "MethodDeclList":   [
                                ["", "$$ = [];"],
                                ["MethodDecl MethodDeclList", "$2.unshift($1); $$ = $2;"],
                            ],
        "MethodDecl":       [
                                ["public Type JavaID ( FormalList ) { StmtList return Expr ; }", "$$ = new yy.ASTNode('MethodDecl', $5.concat($8), { 'returnExpression': $10, 'returnType': $2, 'methodName': $3, 'lineNumber': yylineno });"],
                            ],
        "FormalList":       [
                                ["", "$$ = [];"],
                                ["Formal FormalList_", "$2.unshift($1); $$ = $2;"],
                            ],
        "FormalList_":      [
                                ["", "$$ = [];"],
                                [", Formal FormalList_", "$3.unshift($2); $$ = $3;"],
                            ],
        "Formal":           [
                                ["Type JavaID", "$$ = new yy.ASTNode('Formal', [], { 'type': $1, 'parameterName': $2, 'lineNumber': yylineno });"],
                            ],
        "Type":             [
                                ["int", "$$ = yytext;"],
                                ["boolean", "$$ = yytext;"],
                                ["ID", "$$ = yytext;"],
                            ],
        "StmtList":         [
                                ["", "$$ = [];"],
                                ["Stmt StmtList", "$2.unshift($1); $$ = $2;"],
                            ],
        "Stmt":             [
                                ["Type JavaID = Expr ;", "$$ = new yy.ASTNode('InitialAssignment', [$4], { 'type': $1, 'var_name': $2 });"],
                                ["{ StmtList }", "$$ = new yy.ASTNode('Block', [].concat($2));"],
                                ["if ( Expr ) Stmt else Stmt", "$$ = new yy.ASTNode('If', [$3, $5, $7]);"],
                                ["while ( Expr ) Stmt", "$$ = new yy.ASTNode('While', [$3, $5]);"],
                                ["printLine ( Expr ) ;", "$$ = new yy.ASTNode('PrintLine', [$3]);"],
                                ["ID = Expr ;", "$$ = new yy.ASTNode('Assignment', [$3], { 'var_name': $1 });"],
                            ],
        "Expr":             [
                                ["Expr + Expr", "$$ = new yy.ASTNode('Add', [$1, $3], { 'checkType': yy.expressionCheck.Add });"],
                                ["Expr - Expr", "$$ = new yy.ASTNode('Subtract', [$1, $3]);"],
                                ["Expr * Expr", "$$ = new yy.ASTNode('Multiply', [$1, $3]);"],
                                ["Expr / Expr", "$$ = new yy.ASTNode('Divide', [$1, $3]);"],
                                ["Expr < Expr", "$$ = new yy.ASTNode('LessThan', [$1, $3]);"],
                                ["Expr <= Expr", "$$ = new yy.ASTNode('LessThanEqual', [$1, $3]);"],
                                ["Expr >= Expr", "$$ = new yy.ASTNode('GreaterThanEqual', [$1, $3]);"],
                                ["Expr > Expr", "$$ = new yy.ASTNode('GreaterThan', [$1, $3]);"],
                                ["Expr == Expr", "$$ = new yy.ASTNode('Equal', [$1, $3]);"],
                                ["Expr != Expr", "$$ = new yy.ASTNode('NotEqual', [$1, $3]);"],
                                ["Expr && Expr", "$$ = new yy.ASTNode('And', [$1, $3]);"],
                                ["Expr || Expr", "$$ = new yy.ASTNode('Or', [$1, $3]);"],
                                ["! Expr", "$$ = new yy.ASTNode('Not', [$2]);"],
                                ["- Expr", "$$ = new yy.ASTNode('Negate', [$2], { 'checkType': yy.expressionCheck.Negate });", {"prec": "UMINUS"}],
                                ["Expr . JavaID ( ParameterList )", "$$ = new yy.ASTNode('Call', [$1, $3, $5]);"],
                                ["new JavaID ( )", "$$ = new yy.ASTNode('Construct', [], { 'constructor':$2, 'checkType': yy.expressionCheck.Construct });"],
                                ["ID", "$$ = new yy.ASTNode('IDExpression', [], { 'expression': yytext });"],
                                ["this", "$$ = new yy.ASTNode('ThisExpression', [], { 'checkType': yy.expressionCheck.This });"],
                                ["Integer", "$$ = new yy.ASTNode('IntegerExpression', [], { 'expression':yytext, 'checkType': yy.expressionCheck.Integer });"],
                                ["null", "$$ = new yy.ASTNode('NullExpression', [], { 'checkType': yy.expressionCheck.Null });"],
                                ["true", "$$ = new yy.ASTNode('TrueExpression', [], { 'checkType': yy.expressionCheck.True });"],
                                ["false", "$$ = new yy.ASTNode('FalseExpression', []);"], 
                                ["( Expr )", "$$ = $2;"],
                            ],
        "ParameterList":    [
                                ["", "$$ = [];"],
                                ["Expr ParameterList_", "$2.unshift($1); $$ = $2;"],
                            ],
        "ParameterList_":   [
                                ["", "$$ = [];"],
                                [", Expr ParameterList_", "$3.unshift($2); $$ = $3;"],
                            ],
        "JavaID":           [
                                ["ID", "$$ = yytext"],
                            ],
    }
}